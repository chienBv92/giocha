@model IEnumerable<Web_Gio_Cha.EF.Product>
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@foreach (var item in Model)
{
    var data = item.Discount;

}
@* Slideshow *@
<div class="row form-group nomargin">
    <div class=" col-md-12 col-sm-12 col-xs-12 slideshow"><img src="/Images/bannerMain.jpg" alt="" style="width:100%;" /></div>
</div>
@* Favourites *@
<div class="row form-group nomargin" style="padding-bottom:15px;    ">
    <div class="col-md-4 col-sm-3 col-xs-3"></div>
    <div class="col-md-4 col-sm-6 col-xs-6 col-xs-12"><span class="Titlesanpham" style="margin-top:10px"> SẢN PHẨM TIÊU BIỂU</span></div>
</div>
@* Product item *@
<div class="row form-group nomargin">
    @foreach (var item in Model)
    {
        var link = "/xem-chi-tiet/" + item.MetaTitle + "/" + item.ID;
        var imglink = item.Image != null ? item.Image : "/Images/demosanpham1.jpg";
        @* Info product *@
        <div class="product col-md-3 col-sm-4 col-xs-6">
            <div class="row nomargin prd-content discount">
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <a href="@link"><img class="prd-img" src="@imglink" title="@item.Name" alt="giò chả Vân Bảo" /></a>
                </div>
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <a href="@link" class="link-normal">
                        <p height="20" align="center" class="prd-title break-text" title="@item.Name">@item.Name</p>
                    </a>
                    <p><strong>Giá gốc: <s class="co0066cc money">@item.PriceBefore</s></strong></p>
                    <p><strong style="color: #ff0000">Giá KM: <span class="co0066cc money" style="color:#ff0000">@item.Price</span></strong></p>
                </div>
            </div>
            @* Button *@
            <div class="row nomargin prd-content">
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="row nomargin">
                        <div class="col-md-6 col-sm-12 col-xs-6 padding-2">
                            @*@Ajax.ActionLink("Thêm vào giỏ", "ThemGioHang", "GioHang", new { @IdSanPham = item.ID, @strUrl = Request.Url.ToString() }, new AjaxOptions { HttpMethod = "GET", UpdateTargetId = "divGioHang", InsertionMode = InsertionMode.Replace }, new { @class = "btn btn-success" })*@
                            @*<button class="add-to-cart" title="Thêm vào giỏ" type="button" style="width:50%; height:30px">
                                @*<i class="btn-icon btn-regist"></i>*@
                            @*<img class="img-add-cart" src="~/Icons/add-cart.png" alt="" title="Thêm giỏ hàng" />
                                </button>*@
                            <img class="img-add-cart" src="~/Icons/add-cart.png" data-id="@item.ID" title="Thêm giỏ hàng" style="cursor:pointer" />
                            @*<a href="@Ajax.ActionLink("ThemGioHang", "GioHang", new { @IdSanPham = item.ID, @strUrl= Request.Url.ToString() })"><img class="img-add-cart" src="~/Icons/add-cart.png" alt="" title="Thêm giỏ hàng" /></a>*@
                        </div>
                        <div class="col-md-6 col-sm-12 col-xs-6 padding-2">
                            <a href="#"><img class="btn-img" src="/Images/btBogio.jpg" alt="" title="Đặt hàng" /></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    }
</div>
<script>
    $(document).ready(function () {
        setDiscount();

        // Format money
        $(".money").each(function () {
            var data = WebDuhoc.utility.convertIntToMoney($(this).text());
            $(this).text(data);
        });

    });
    function setDiscount() {
        var data = @Html.Raw(Json.Encode(Model.Select(x=>x.Discount)));
        var maxItem = data.length;
        var count = 0;
        $(".discount").each(function () {
            if (count < maxItem) {
                $(this).attr('data-content', data[count] + "%");
                count++;
            }
        });
    }

    $(document).off('.img-add-cart');
    $(document).on('click', '.img-add-cart', function () {

        //var cart = $('.Viewcart');

        //var parent = $(this).parents('.product');

        //var pos = parent.position();

        //var parentTop = parent.offset().top;
        //var parentLeft = parent.offset().left;

        //var src = parent.find('.prd-img').attr('src');
        //var img = $('<img />', {
        //    src: src,
        //    id: 'img-product-fly',
        //    alt: 'thêm giỏ hàng'
        //});
        //img.appendTo($('body').css({
        //    'top': parentTop,
        //    'left': parseInt(parentLeft) + parent.width() - 50}
        //    ));

        //setTimeout(function(){
        //    $(document).find('#img-product-fly').css({
        //        'top': cart.offset.top,
        //        'left': cart.offset.left
        //    });

        //    setTimeout(function(){
        //        $(document).find('#img-product-fly').remove();
        //    }, 1000)
        //}, 500)

        var Id = $(this).data('id');
        if (Id == '') return;

        $.ajax({
            cache: false,
            type: "POST",
            url: '@Url.Action("ThemGioHangAjax", "GioHang")',
            data: { Id: Id },
            success: function (res) {
                if(res.TongSoLuong > 0){
                    $("#update-SoLuong").text(res.TongSoLuong + " sản phẩm");
                    var totalMoney = WebDuhoc.utility.convertIntToMoney(res.TotalMoney);
                    $("#updateTotalMoney").text(totalMoney);
                    alert("Đã thêm vào giỏ hàng!");
                }

            },
            error: function (xhr, ajaxOptions, thrownError) {
                window.location.href = '/Common/Error/';
            }
        });

    });
</script>

<style>
    body {
        position: relative;
    }

    #img-product-fly {
        position: absolute;
        z-index: 99999;
        width: 50px;
        height: 50px;
        object-fit: cover;
        border-radius: 100%;
        border: 2px solid #ff0000;
        transition: all 1s ease;
    }
</style>